<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Calendario - Copa Ra√∫l Roja</title>
  <link rel="stylesheet" href="styles.css">
  <meta name="description" content="Calendario de partidos - Copa Ra√∫l Roja">
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <h1 class="logo">Copa <span class="highlight">Ra√∫l Rojas</span></h1>
      <nav class="nav">
        <a href="index.html#home">Inicio</a>
        <a href="tabla.html">Tabla</a>
        <a href="calendar.html" aria-current="page">Calendario</a>
        <a href="equipos.html">Equipos</a>
        <a href="estadisticas.html">Estad√≠sticas</a>
      </nav>
    </div>
  </header>

  <main>
    <div class="container">
      <section class="section card calendar-card">
        <div class="standings-header">
          <div>
            <h3>Calendario de Partidos</h3>
            <p class="muted">Partidos programados para el torneo</p>
          </div>
          <div class="standings-actions">
            <a href="index.html" class="btn ghost">Volver</a>
          </div>
        </div>

        <div class="accordion" id="calendar-accordion">
          <div class="item">
            <button class="item-header" type="button">
              <span class="dot"></span>
              <span class="title">Primera jornada</span>
              <span class="meta">3 partidos</span>
              <span class="chev">‚ñæ</span>
            </button>
            <div class="item-body">
              <ul style="list-style:none;padding:0;margin:0;">
                <li class="match-item">
                  <div class="match-row">
                    <div class="match-teams">
                      <img src="https://sclrcoiisappnzbaxlzc.supabase.co/storage/v1/object/public/team-logos/teams/32314b3b-6ef8-4e0a-a5f2-0c9b08c75961/logo.jpg" alt="Gladiadores" class="team-thumb">
                      <strong>Gladiadores</strong>
                      <span style="color:var(--muted);margin:0 .4rem">vs</span>
                      <img src="https://sclrcoiisappnzbaxlzc.supabase.co/storage/v1/object/public/team-logos/teams/37af335f-ef37-4d61-8221-801e13d64713/logo.jpg?v=1758392886644" alt="Klan" class="team-thumb">
                      <strong>Klan</strong>
                    </div>
                    <div class="match-time">08:00 AM</div>
                  </div>
                  <a class="event-btn" href="event.html?team1=Gladiadores&team2=Klan&time=08:00%20AM">Ir a evento</a>
                  <div class="match-actions"></div>
                </li>

                <li class="match-item">
                  <div class="match-row">
                    <div class="match-teams">
                      <img src="https://sclrcoiisappnzbaxlzc.supabase.co/storage/v1/object/public/team-logos/teams/d00bbe10-d6d8-470a-8ef3-2a4ab27c58c3/logo.jpg" alt="FC 9no" class="team-thumb">
                      <strong>FC 9no</strong>
                      <span style="color:var(--muted);margin:0 .4rem">vs</span>
                      <img src="https://sclrcoiisappnzbaxlzc.supabase.co/storage/v1/object/public/team-logos/teams/0b203679-a1c9-49b1-a316-e2a588495d6f/logo.jpg?v=1758390280487" alt="Los Descalsos" class="team-thumb">
                      <strong>Los Descalsos</strong>
                    </div>
                    <div class="match-time">08:40 AM</div>
                  </div>
                  <a class="event-btn" href="event.html?team1=FC%209no&team2=Los%20Descalsos&time=08:40%20AM">Ir a evento</a>
                  <div class="match-actions"></div>
                </li>

                <li class="match-item">
                  <div class="match-row">
                    <div class="match-teams">
                      <img src="https://sclrcoiisappnzbaxlzc.supabase.co/storage/v1/object/public/team-logos/teams/a9e7ac21-550a-4350-82ae-677979f69a81/logo.jpg?v=1758735227385" alt="Scorpions" class="team-thumb">
                      <strong>Scorpions</strong>
                      <span style="color:var(--muted);margin:0 .4rem">vs</span>
                      <img src="https://sclrcoiisappnzbaxlzc.supabase.co/storage/v1/object/public/team-logos/teams/afe8cc36-d1b7-4052-ad89-99443c3e52f0/logo.jpg?v=1758388008060" alt="Raul Rojas" class="team-thumb">
                      <strong>Raul Rojas</strong>
                    </div>
                    <div class="match-time">09:20 AM</div>
                  </div>
                  <a class="event-btn" href="event.html?team1=Scorpions&team2=Raul%20Rojas&time=09:20%20AM">Ir a evento</a>
                  <div class="match-actions"></div>
                </li>
              </ul>
            </div>
          </div>

          <div class="item">
            <button class="item-header" type="button">
              <span class="dot"></span>
              <span class="title">Segunda jornada</span>
              <span class="meta">3 partidos</span>
              <span class="chev">‚ñæ</span>
            </button>
            <div class="item-body">
              <ul style="list-style:none;padding:0;margin:0;">
                <li class="match-item">
                  <div class="match-row">
                    <div class="match-teams">
                      <img src="https://via.placeholder.com/28" alt="Gamboleros" class="team-thumb">
                      <strong>Gamboleros</strong>
                      <span style="color:var(--muted);margin:0 .4rem">vs</span>
                      <img src="https://sclrcoiisappnzbaxlzc.supabase.co/storage/v1/object/public/team-logos/teams/37af335f-ef37-4d61-8221-801e13d64713/logo.jpg?v=1758392886644" alt="Klan" class="team-thumb">
                      <strong>Klan</strong>
                    </div>
                    <div class="match-time">10:00 AM</div>
                  </div>
                  <a class="event-btn" href="event.html?team1=Gamboleros&team2=Klan&time=10:00%20AM">Ir a evento</a>
                  <div class="match-actions"></div>
                </li>

                <li class="match-item">
                  <div class="match-row">
                    <div class="match-teams">
                      <img src="https://sclrcoiisappnzbaxlzc.supabase.co/storage/v1/object/public/team-logos/teams/32314b3b-6ef8-4e0a-a5f2-0c9b08c75961/logo.jpg" alt="Gladiadores" class="team-thumb">
                      <strong>Gladiadores</strong>
                      <span style="color:var(--muted);margin:0 .4rem">vs</span>
                      <img src="https://sclrcoiisappnzbaxlzc.supabase.co/storage/v1/object/public/team-logos/teams/d00bbe10-d6d8-470a-8ef3-2a4ab27c58c3/logo.jpg" alt="FC 9no" class="team-thumb">
                      <strong>FC 9no</strong>
                    </div>
                    <div class="match-time">10:40 AM</div>
                  </div>
                  <a class="event-btn" href="event.html?team1=Gladiadores&team2=FC%209no&time=10:40%20AM">Ir a evento</a>
                  <div class="match-actions"></div>
                </li>

                <li class="match-item">
                  <div class="match-row">
                    <div class="match-teams">
                      <img src="https://sclrcoiisappnzbaxlzc.supabase.co/storage/v1/object/public/team-logos/teams/0b203679-a1c9-49b1-a316-e2a588495d6f/logo.jpg?v=1758390280487" alt="Los Descalsos" class="team-thumb">
                      <strong>Los Descalsos</strong>
                      <span style="color:var(--muted);margin:0 .4rem">vs</span>
                      <img src="https://sclrcoiisappnzbaxlzc.supabase.co/storage/v1/object/public/team-logos/teams/a9e7ac21-550a-4350-82ae-677979f69a81/logo.jpg?v=1758735227385" alt="Scorpions" class="team-thumb">
                      <strong>Scorpions</strong>
                    </div>
                    <div class="match-time">11:20 AM</div>
                  </div>
                  <a class="event-btn" href="event.html?team1=Los%20Descalsos&team2=Scorpions&time=11:20%20AM">Ir a evento</a>
                  <div class="match-actions"></div>
                </li>
              </ul>
            </div>
          </div>

          <div class="item">
            <button class="item-header" type="button">
              <span class="dot"></span>
              <span class="title">Tercera jornada</span>
              <span class="meta">3 partidos</span>
              <span class="chev">‚ñæ</span>
            </button>
            <div class="item-body">
              <ul style="list-style:none;padding:0;margin:0;">
                <li class="match-item">
                  <div class="match-row">
                    <div class="match-teams">
                      <img src="https://sclrcoiisappnzbaxlzc.supabase.co/storage/v1/object/public/team-logos/teams/37af335f-ef37-4d61-8221-801e13d64713/logo.jpg?v=1758392886644" alt="Klan" class="team-thumb">
                      <strong>Klan</strong>
                      <span style="color:var(--muted);margin:0 .4rem">vs</span>
                      <img src="https://sclrcoiisappnzbaxlzc.supabase.co/storage/v1/object/public/team-logos/teams/d00bbe10-d6d8-470a-8ef3-2a4ab27c58c3/logo.jpg" alt="FC 9no" class="team-thumb">
                      <strong>FC 9no</strong>
                    </div>
                    <div class="match-time">12:00 PM</div>
                  </div>
                  <a class="event-btn" href="event.html?team1=Klan&team2=FC%209no&time=12:00%20PM">Ir a evento</a>
                  <div class="match-actions"></div>
                </li>

                <li class="match-item">
                  <div class="match-row">
                    <div class="match-teams">
                      <img src="https://sclrcoiisappnzbaxlzc.supabase.co/storage/v1/object/public/team-logos/teams/32314b3b-6ef8-4e0a-a5f2-0c9b08c75961/logo.jpg" alt="Gladiadores" class="team-thumb">
                      <strong>Gladiadores</strong>
                      <span style="color:var(--muted);margin:0 .4rem">vs</span>
                      <img src="https://sclrcoiisappnzbaxlzc.supabase.co/storage/v1/object/public/team-logos/teams/0b203679-a1c9-49b1-a316-e2a588495d6f/logo.jpg?v=1758390280487" alt="Los Descalsos" class="team-thumb">
                      <strong>Los Descalsos</strong>
                    </div>
                    <div class="match-time">12:40 PM</div>
                  </div>
                  <a class="event-btn" href="event.html?team1=Gladiadores&team2=Los%20Descalsos&time=12:40%20PM">Ir a evento</a>
                  <div class="match-actions"></div>
                </li>

                <li class="match-item">
                  <div class="match-row">
                    <div class="match-teams">
                      <img src="https://sclrcoiisappnzbaxlzc.supabase.co/storage/v1/object/public/team-logos/teams/a9e7ac21-550a-4350-82ae-677979f69a81/logo.jpg?v=1758735227385" alt="Scorpions" class="team-thumb">
                      <strong>Scorpions</strong>
                      <span style="color:var(--muted);margin:0 .4rem">vs</span>
                      <img src="https://via.placeholder.com/28" alt="Gamboleros" class="team-thumb">
                      <strong>Gamboleros</strong>
                    </div>
                    <div class="match-time">01:20 PM</div>
                  </div>
                  <a class="event-btn" href="event.html?team1=Scorpions&team2=Gamboleros&time=01:20%20PM">Ir a evento</a>
                  <div class="match-actions"></div>
                </li>
              </ul>
            </div>
          </div>

          <div class="item">
            <button class="item-header" type="button">
              <span class="dot"></span>
              <span class="title">Cuarta jornada</span>
              <span class="meta">3 partidos</span>
              <span class="chev">‚ñæ</span>
            </button>
            <div class="item-body">
              <ul style="list-style:none;padding:0;margin:0;">
                <li class="match-item">
                  <div class="match-row">
                    <div class="match-teams">
                      <img src="https://sclrcoiisappnzbaxlzc.supabase.co/storage/v1/object/public/team-logos/teams/d00bbe10-d6d8-470a-8ef3-2a4ab27c58c3/logo.jpg" alt="FC 9no" class="team-thumb">
                      <strong>FC 9no</strong>
                      <span style="color:var(--muted);margin:0 .4rem">vs</span>
                      <img src="https://sclrcoiisappnzbaxlzc.supabase.co/storage/v1/object/public/team-logos/teams/a9e7ac21-550a-4350-82ae-677979f69a81/logo.jpg?v=1758735227385" alt="Scorpions" class="team-thumb">
                      <strong>Scorpions</strong>
                    </div>
                    <div class="match-time">02:00 PM</div>
                  </div>
                  <a class="event-btn" href="event.html?team1=FC%209no&team2=Scorpions&time=02:00%20PM">Ir a evento</a>
                  <div class="match-actions"></div>
                </li>

                <li class="match-item">
                  <div class="match-row">
                    <div class="match-teams">
                      <img src="https://sclrcoiisappnzbaxlzc.supabase.co/storage/v1/object/public/team-logos/teams/37af335f-ef37-4d61-8221-801e13d64713/logo.jpg?v=1758392886644" alt="Klan" class="team-thumb">
                      <strong>Klan</strong>
                      <span style="color:var(--muted);margin:0 .4rem">vs</span>
                      <img src="https://sclrcoiisappnzbaxlzc.supabase.co/storage/v1/object/public/team-logos/teams/32314b3b-6ef8-4e0a-a5f2-0c9b08c75961/logo.jpg" alt="Gladiadores" class="team-thumb">
                      <strong>Gladiadores</strong>
                    </div>
                    <div class="match-time">02:40 PM</div>
                  </div>
                  <a class="event-btn" href="event.html?team1=Klan&team2=Gladiadores&time=02:40%20PM">Ir a evento</a>
                  <div class="match-actions"></div>
                </li>

                <li class="match-item">
                  <div class="match-row">
                    <div class="match-teams">
                      <img src="https://sclrcoiisappnzbaxlzc.supabase.co/storage/v1/object/public/team-logos/teams/afe8cc36-d1b7-4052-ad89-99443c3e52f0/logo.jpg?v=1758388008060" alt="Raul Rojas" class="team-thumb">
                      <strong>Raul Rojas</strong>
                      <span style="color:var(--muted);margin:0 .4rem">vs</span>
                      <img src="https://via.placeholder.com/28" alt="Gamboleros" class="team-thumb">
                      <strong>Gamboleros</strong>
                    </div>
                    <div class="match-time">03:20 PM</div>
                  </div>
                  <a class="event-btn" href="event.html?team1=Raul%20Rojas&team2=Gamboleros&time=03:20%20PM">Ir a evento</a>
                  <div class="match-actions"></div>
                </li>
              </ul>
            </div>
          </div>

          <div class="item">
            <button class="item-header" type="button">
              <span class="dot"></span>
              <span class="title">Quinta jornada</span>
              <span class="meta">3 partidos</span>
              <span class="chev">‚ñæ</span>
            </button>
            <div class="item-body">
              <ul style="list-style:none;padding:0;margin:0;">
                <li class="match-item">
                  <div class="match-row">
                    <div class="match-teams">
                      <img src="https://sclrcoiisappnzbaxlzc.supabase.co/storage/v1/object/public/team-logos/teams/0b203679-a1c9-49b1-a316-e2a588495d6f/logo.jpg?v=1758390280487" alt="Los Descalsos" class="team-thumb">
                      <strong>Los Descalsos</strong>
                      <span style="color:var(--muted);margin:0 .4rem">vs</span>
                      <img src="https://sclrcoiisappnzbaxlzc.supabase.co/storage/v1/object/public/team-logos/teams/37af335f-ef37-4d61-8221-801e13d64713/logo.jpg?v=1758392886644" alt="Klan" class="team-thumb">
                      <strong>Klan</strong>
                    </div>
                    <div class="match-time">04:00 PM</div>
                  </div>
                  <a class="event-btn" href="event.html?team1=Los%20Descalsos&team2=Klan&time=04:00%20PM">Ir a evento</a>
                  <div class="match-actions"></div>
                </li>

                <li class="match-item">
                  <div class="match-row">
                    <div class="match-teams">
                      <img src="https://sclrcoiisappnzbaxlzc.supabase.co/storage/v1/object/public/team-logos/teams/32314b3b-6ef8-4e0a-a5f2-0c9b08c75961/logo.jpg" alt="Gladiadores" class="team-thumb">
                      <strong>Gladiadores</strong>
                      <span style="color:var(--muted);margin:0 .4rem">vs</span>
                      <img src="https://sclrcoiisappnzbaxlzc.supabase.co/storage/v1/object/public/team-logos/teams/a9e7ac21-550a-4350-82ae-677979f69a81/logo.jpg?v=1758735227385" alt="Scorpions" class="team-thumb">
                      <strong>Scorpions</strong>
                    </div>
                    <div class="match-time">04:40 PM</div>
                  </div>
                  <a class="event-btn" href="event.html?team1=Gladiadores&team2=Scorpions&time=04:40%20PM">Ir a evento</a>
                  <div class="match-actions"></div>
                </li>

                <li class="match-item">
                  <div class="match-row">
                    <div class="match-teams">
                      <img src="https://sclrcoiisappnzbaxlzc.supabase.co/storage/v1/object/public/team-logos/teams/d00bbe10-d6d8-470a-8ef3-2a4ab27c58c3/logo.jpg" alt="FC 9no" class="team-thumb">
                      <strong>FC 9no</strong>
                      <span style="color:var(--muted);margin:0 .4rem">vs</span>
                      <img src="https://sclrcoiisappnzbaxlzc.supabase.co/storage/v1/object/public/team-logos/teams/afe8cc36-d1b7-4052-ad89-99443c3e52f0/logo.jpg?v=1758388008060" alt="Raul Rojas" class="team-thumb">
                      <strong>Raul Rojas</strong>
                    </div>
                    <div class="match-time">05:20 PM</div>
                  </div>
                  <a class="event-btn" href="event.html?team1=FC%209no&team2=Raul%20Rojas&time=05:20%20PM">Ir a evento</a>
                  <div class="match-actions"></div>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <footer class="site-footer">
    <div class="container">
      <p>¬© Copa Ra√∫l Roja ‚Äî Todos los derechos reservados</p>
    </div>
  </footer>

  <script>
    // Peque√±a interactividad para el acorde√≥n local
    document.addEventListener('DOMContentLoaded', ()=>{
      document.querySelectorAll('.accordion .item').forEach(item=>{
        const header = item.querySelector('.item-header');
        if(!header) return;
        header.addEventListener('click', ()=>{
          const open = item.classList.contains('open');
          item.parentElement.querySelectorAll('.item').forEach(i=>i.classList.remove('open'));
          if(!open) item.classList.add('open');
        });
      });
    });

    // Mostrar resultados guardados en localStorage junto a cada partido
    function matchKey(a,b,t){
      return `match::${encodeURIComponent(a)}::${encodeURIComponent(b)}::${encodeURIComponent(t||'')}`;
    }

    function normalizeName(node){
      // obtiene el texto del primer strong dentro del node
      const s = node.querySelectorAll('strong');
      if(!s || s.length<2) return null;
      return [s[0].textContent.trim(), s[1].textContent.trim()];
    }

    // al cargar, recorrer matches y a√±adir marcador de score si existe
    function updateScores(){
      document.querySelectorAll('.match-item').forEach(item=>{
        const teams = normalizeName(item.querySelector('.match-teams'));
        const timeEl = item.querySelector('.match-time');
        const time = timeEl ? timeEl.textContent.trim() : '';
        if(!teams) return;
        const key = matchKey(teams[0], teams[1], time);
        const raw = localStorage.getItem(key);
        const existing = item.querySelector('.match-score'); if(existing) existing.remove();
        const existingMvp = item.querySelector('.match-mvp'); if(existingMvp) existingMvp.remove();
        if(raw){
          try{
            const obj = JSON.parse(raw);
            const span = document.createElement('span');
            span.className = 'match-score';
            span.style.marginLeft = '8px';
            span.style.fontWeight = '800';
            span.style.color = 'var(--accent)';
            span.textContent = `(${obj.score1} ‚Äî ${obj.score2})`;
            const teamsNode = item.querySelector('.match-teams');
            teamsNode.appendChild(span);
            if(obj.mvp){
              const m = document.createElement('span');
              m.className = 'match-mvp';
              m.style.marginLeft = '10px';
              m.style.fontSize = '0.9rem';
              m.style.color = 'var(--muted)';
              m.textContent = `MVP: ${obj.mvp}`;
              teamsNode.appendChild(m);
            }
            // render votes: show highlighted top MVP and a toggle to view full breakdown
            if(obj.votes){
              const votes = obj.votes || {};
              const agg = {};
              Object.keys(votes).forEach(k=>{
                const raw = (k||'').trim(); if(!raw) return;
                const norm = raw.toLowerCase();
                if(!agg[norm]) agg[norm] = { name: raw, count: 0 };
                agg[norm].count += Number(votes[k]) || 0;
              });
              const list = Object.keys(agg).map(k=>agg[k]);
              if(list.length){
                list.sort((a,b)=>b.count - a.count);
                const top = list[0];
                // top MVP badge
                const topEl = document.createElement('span');
                topEl.className = 'match-mvp-top';
                topEl.style.marginLeft = '10px';
                topEl.style.fontWeight = '700';
                topEl.style.color = 'var(--accent)';
                topEl.style.cursor = 'pointer';
                topEl.textContent = `üèÜ ${top.name}`; // show name only; counts in panel
                teamsNode.appendChild(topEl);

                // create small toggle to view full votes in an anchored panel in .match-actions
                const actions = item.querySelector('.match-actions');
                if(actions){
                  // remove existing panel/button
                  const existingBtn = actions.querySelector('.view-votes-btn'); if(existingBtn) existingBtn.remove();
                  const existingPanel = actions.querySelector('.votes-panel'); if(existingPanel) existingPanel.remove();
                  const viewBtn = document.createElement('button'); viewBtn.type='button'; viewBtn.className='view-votes-btn btn ghost'; viewBtn.textContent='Ver votos'; viewBtn.style.marginLeft='8px';
                  actions.appendChild(viewBtn);
                  const panel = document.createElement('div'); panel.className='votes-panel'; panel.style.display='none'; panel.style.marginTop='6px'; panel.style.background='rgba(0,0,0,0.04)'; panel.style.padding='6px'; panel.style.borderRadius='6px'; panel.style.fontSize='0.85rem'; panel.style.color='var(--muted)';
                  list.forEach(it=>{ const row = document.createElement('div'); row.textContent = `${it.name} ‚Äî ${it.count}`; panel.appendChild(row); });
                  actions.appendChild(panel);
                  viewBtn.addEventListener('click', ()=>{ panel.style.display = panel.style.display === 'none' ? 'block' : 'none'; });
                  // clicking the top MVP also toggles the panel
                  topEl.addEventListener('click', ()=>{ panel.style.display = panel.style.display === 'none' ? 'block' : 'none'; });
                }
              }
            }
          }catch(e){console.error('invalid stored match',e)}
        }
      });
    }

    // Inject MVP buttons and handle saving MVP for each match
    function attachMvpButtons(){
      document.querySelectorAll('.match-item').forEach(item=>{
        const actions = item.querySelector('.match-actions') || (item.querySelector('.event-btn') && item.querySelector('.event-btn').parentNode) || item;

        // helper to get-or-create element
        function getEl(selector, createFn){
          let el = item.querySelector(selector);
          if(!el){ el = createFn(); (actions || item).appendChild(el); }
          return el;
        }

        // MVP manual button
        const mvpBtn = getEl('.mvp-btn', ()=>{
          const b = document.createElement('button'); b.type='button'; b.className='mvp-btn btn ghost'; b.textContent='MVP'; b.style.marginLeft='8px';
          b.addEventListener('click', ()=>{
            const teams = normalizeName(item.querySelector('.match-teams'));
            const time = item.querySelector('.match-time')?.textContent.trim() || '';
            if(!teams) return;
            const key = matchKey(teams[0], teams[1], time);
            const roster1 = JSON.parse(localStorage.getItem(`team::${encodeURIComponent(teams[0])}::players`) || '[]');
            const roster2 = JSON.parse(localStorage.getItem(`team::${encodeURIComponent(teams[1])}::players`) || '[]');
            const suggestions = roster1.concat(roster2).map(p=>p.name).filter(Boolean);
            const defaultVal = (JSON.parse(localStorage.getItem(key) || '{}').mvp) || '';
            let promptMsg = 'Introduce el nombre del MVP para ' + teams[0] + ' vs ' + teams[1];
            if(suggestions.length) promptMsg += '\nSugerencias: ' + suggestions.join(', ');
            const name = window.prompt(promptMsg, defaultVal);
            if(name === null) return;
            let obj = {};
            try{ obj = JSON.parse(localStorage.getItem(key) || '{}'); }catch(e){ obj = {}; }
            obj.mvp = name.trim();
            try{ localStorage.setItem(key, JSON.stringify(obj)); window.dispatchEvent(new Event('matches-updated')); }catch(e){ console.error('save mvp',e); }
            updateScores();
          });
          return b;
        });

        // Vote button
        const voteBtn = getEl('.vote-btn', ()=>{ const b = document.createElement('button'); b.type='button'; b.className='vote-btn btn'; b.textContent='Votar'; b.style.marginLeft='6px'; return b; });
        // Remove button
        const removeBtn = getEl('.remove-vote-btn', ()=>{ const b = document.createElement('button'); b.type='button'; b.className='remove-vote-btn btn ghost'; b.textContent='Quitar voto'; b.style.marginLeft='6px'; return b; });
        // Your vote indicator
        const yourVote = getEl('.your-vote', ()=>{ const s = document.createElement('span'); s.className='your-vote muted'; s.style.marginLeft='8px'; s.style.fontSize='0.9rem'; return s; });

        // helper: show toast
        function showToast(msg){
          let t = document.getElementById('site-toast');
          if(!t){ t = document.createElement('div'); t.id='site-toast'; t.style.position='fixed'; t.style.right='16px'; t.style.bottom='16px'; t.style.background='rgba(0,0,0,0.85)'; t.style.color='white'; t.style.padding='8px 12px'; t.style.borderRadius='8px'; t.style.zIndex='9999'; document.body.appendChild(t); }
          t.textContent = msg; t.style.opacity='1'; clearTimeout(t._t); t._t = setTimeout(()=>{ t.style.transition='opacity 300ms'; t.style.opacity='0'; }, 1600);
        }

        // attach handlers only once
        if(!voteBtn._bound){
          voteBtn._bound = true;
          voteBtn.addEventListener('click', ()=>{
            const teams = normalizeName(item.querySelector('.match-teams'));
            const time = item.querySelector('.match-time')?.textContent.trim() || '';
            if(!teams) return;
            const key = matchKey(teams[0], teams[1], time);
            const voteKey = `vote::${key}`;
            const roster1 = JSON.parse(localStorage.getItem(`team::${encodeURIComponent(teams[0])}::players`) || '[]');
            const roster2 = JSON.parse(localStorage.getItem(`team::${encodeURIComponent(teams[1])}::players`) || '[]');
            const suggestions = roster1.concat(roster2).map(p=>p.name).filter(Boolean);
            let promptMsg = 'Vota al MVP para ' + teams[0] + ' vs ' + teams[1];
            if(suggestions.length) promptMsg += '\nSugerencias: ' + suggestions.join(', ');
            const prevStored = localStorage.getItem(voteKey) || '';
            const choice = window.prompt(promptMsg, prevStored);
            if(choice === null) return;
            const chosenRaw = choice.trim(); if(!chosenRaw) return;
            let obj = {};
            try{ obj = JSON.parse(localStorage.getItem(key) || '{}'); }catch(e){ obj = {}; }
            if(!obj.votes) obj.votes = {};
            const prev = localStorage.getItem(voteKey);
            if(prev){ const prevKey = Object.keys(obj.votes).find(k=>k.toLowerCase()===prev.toLowerCase()); if(prevKey){ obj.votes[prevKey] = Math.max(0,obj.votes[prevKey]-1); if(obj.votes[prevKey]===0) delete obj.votes[prevKey]; }}
            const existingKey = Object.keys(obj.votes).find(k=>k.toLowerCase()===chosenRaw.toLowerCase());
            const storeKey = existingKey || chosenRaw;
            obj.votes[storeKey] = (obj.votes[storeKey]||0)+1;
            try{ localStorage.setItem(key, JSON.stringify(obj)); localStorage.setItem(voteKey, storeKey); window.dispatchEvent(new Event('matches-updated')); }catch(e){ console.error('save vote', e); }
            yourVote.textContent = `Tu voto: ${storeKey}`; removeBtn.disabled = false; showToast('Voto registrado'); updateScores();
          });
        }

        if(!removeBtn._bound){
          removeBtn._bound = true;
          removeBtn.addEventListener('click', ()=>{
            if(!confirm('¬øQuieres quitar tu voto?')) return;
            const teams = normalizeName(item.querySelector('.match-teams'));
            const time = item.querySelector('.match-time')?.textContent.trim() || '';
            if(!teams) return;
            const key = matchKey(teams[0], teams[1], time);
            const voteKey = `vote::${key}`;
            const prev = localStorage.getItem(voteKey);
            if(!prev){ removeBtn.disabled = true; yourVote.textContent=''; return; }
            let obj = {};
            try{ obj = JSON.parse(localStorage.getItem(key) || '{}'); }catch(e){ obj = {}; }
            if(obj.votes){ const prevKey = Object.keys(obj.votes).find(k=>k.toLowerCase()===prev.toLowerCase()); if(prevKey){ obj.votes[prevKey] = Math.max(0,obj.votes[prevKey]-1); if(obj.votes[prevKey]===0) delete obj.votes[prevKey]; }}
            try{ localStorage.setItem(key, JSON.stringify(obj)); localStorage.removeItem(voteKey); window.dispatchEvent(new Event('matches-updated')); }catch(e){ console.error('remove vote', e); }
            yourVote.textContent=''; removeBtn.disabled=true; showToast('Voto eliminado'); updateScores();
          });
        }

        // initialize state for this match
        try{
          const teamsInit = normalizeName(item.querySelector('.match-teams'));
          const timeInit = item.querySelector('.match-time')?.textContent.trim() || '';
          const keyInit = teamsInit ? matchKey(teamsInit[0], teamsInit[1], timeInit) : null;
          const voteKeyInit = keyInit ? `vote::${keyInit}` : null;
          const cv = voteKeyInit ? localStorage.getItem(voteKeyInit) : '';
          if(cv){ yourVote.textContent = `Tu voto: ${cv}`; removeBtn.disabled = false; } else { yourVote.textContent = ''; removeBtn.disabled = true; }
        }catch(e){}
      });
    }

    document.addEventListener('DOMContentLoaded', ()=>{ attachMvpButtons(); updateScores(); });
    window.addEventListener('storage', (e)=>{ if(e.key && e.key.startsWith('match::')) { attachMvpButtons(); updateScores(); } });

    document.addEventListener('DOMContentLoaded', updateScores);
    window.addEventListener('storage', (e)=>{ if(e.key && e.key.startsWith('match::')) updateScores(); });
    window.addEventListener('matches-updated', updateScores);
  </script>
</body>
</html>
