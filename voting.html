<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Votaci√≥n - Impostor Caney</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üïµÔ∏è</text></svg>">
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #1a1a1a;
            color: #ffffff;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            text-align: center;
        }
        .card {
            max-width: 600px;
            background-color: #2a2a2a;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }
        h1, h2 {
            color: #ff4444;
            text-shadow: 0 0 10px rgba(255, 68, 68, 0.5);
        }
        .vote-item {
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        select {
            padding: 5px;
            background-color: #333;
            color: #fff;
            border: 1px solid #444;
            border-radius: 5px;
        }
        button {
            background-color: #ff4444;
            color: #fff;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
        }
        button:hover {
            background-color: #cc3333;
        }
        .hidden {
            display: none;
        }
        @media (max-width: 600px) {
            .card {
                padding: 15px;
                max-width: 95%;
            }
            h1 {
                font-size: 24px;
            }
            h2 {
                font-size: 20px;
            }
            .vote-item {
                flex-direction: column;
                align-items: stretch;
            }
            .vote-item span {
                margin-bottom: 5px;
            }
            select {
                width: 100%;
                padding: 8px;
                font-size: 16px;
            }
            button {
                width: 100%;
                padding: 12px;
                font-size: 16px;
                margin: 5px 0;
            }
        }
    </style>
</head>
<body>
    <div class="card">
        <h1>Votaci√≥n</h1>
        <p>Registra los votos de cada jugador:</p>
        <div id="vote-list"></div>
        <button id="count-votes">Contar Votos</button>
        <div id="results" class="hidden">
            <h2>Resultado</h2>
            <p id="voted-player"></p>
            <p id="outcome"></p>
            <button id="restart">Reiniciar Juego</button>
        </div>
    </div>

    <script>
        let players = [];
        let selectedTheme = '';
        let numPlayers = 3;
        let impostorIndex = -1;

        window.onload = function() {
            const data = localStorage.getItem('gameData');
            if (data) {
                const gameData = JSON.parse(data);
                selectedTheme = gameData.selectedTheme;
                numPlayers = gameData.numPlayers;
                const playerNames = gameData.playerNames;
                // Reconstruir players con roles
                players = [];
                for (let i = 0; i < numPlayers; i++) {
                    players.push({ id: i+1, playerName: playerNames[i], role: 'normal', name: null });
                }
                // Asignar roles (copiar l√≥gica de reveal.html)
                assignRoles();
                displayVotes();
            } else {
                alert('No hay datos de juego. Vuelve al inicio.');
                window.location.href = 'index.html';
            }
        };

        function assignRoles() {
            const availableNames = window[selectedTheme] || [];
            availableNames.sort(() => Math.random() - 0.5);
            const numImpostors = numPlayers > 7 ? 2 : 1;
            const impostorIndices = [];
            while (impostorIndices.length < numImpostors) {
                const idx = Math.floor(Math.random() * numPlayers);
                if (!impostorIndices.includes(idx)) {
                    impostorIndices.push(idx);
                }
            }
            impostorIndices.forEach(idx => {
                players[idx].role = 'impostor';
            });
            const assignedName = availableNames[0];
            players.forEach(player => {
                if (player.role !== 'impostor') {
                    player.name = assignedName;
                }
            });
            impostorIndex = impostorIndices[0]; // Asumir uno
        }

        function displayVotes() {
            const voteList = document.getElementById('vote-list');
            voteList.innerHTML = '';
            players.forEach(player => {
                const div = document.createElement('div');
                div.className = 'vote-item';
                div.innerHTML = `
                    <span>${player.playerName} vota por:</span>
                    <select data-player="${player.id}">
                        <option value="">Seleccionar</option>
                        ${players.filter(p => p.id !== player.id).map(p => `<option value="${p.id}">${p.playerName}</option>`).join('')}
                    </select>
                `;
                voteList.appendChild(div);
            });
        }

        document.getElementById('count-votes').addEventListener('click', function() {
            const votes = {};
            players.forEach(player => {
                const select = document.querySelector(`select[data-player="${player.id}"]`);
                const votedId = select.value;
                if (votedId) {
                    if (!votes[votedId]) votes[votedId] = 0;
                    votes[votedId]++;
                }
            });
            // Encontrar el m√°s votado
            let maxVotes = 0;
            let votedPlayerId = null;
            for (const [id, count] of Object.entries(votes)) {
                if (count > maxVotes) {
                    maxVotes = count;
                    votedPlayerId = id;
                }
            }
            if (!votedPlayerId) {
                alert('Todos deben votar.');
                return;
            }
            const votedPlayer = players.find(p => p.id == votedPlayerId);
            document.getElementById('voted-player').textContent = `Jugador votado: ${votedPlayer.playerName}`;
            if (votedPlayer.role === 'impostor') {
                document.getElementById('outcome').textContent = '¬°S√≠ era el impostor!';
            } else {
                document.getElementById('outcome').textContent = 'No era el impostor.';
            }
            document.getElementById('results').classList.remove('hidden');
            document.getElementById('count-votes').classList.add('hidden');
        });

        document.getElementById('restart').addEventListener('click', function() {
            window.location.href = 'index.html';
        });
    </script>
</body>
</html>