<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Evento - Partido</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    .event-page{max-width:980px;margin:28px auto;padding:0 16px}
    .event-card{display:flex;gap:18px;align-items:center;justify-content:space-between;background:linear-gradient(180deg,#0f1b22,#0b1620);padding:18px;border-radius:12px}
    .team-side{flex:1;display:flex;flex-direction:column;align-items:center;gap:12px;padding:12px}
    .team-photo{width:160px;height:160px;border-radius:12px;object-fit:cover;border:4px solid rgba(255,255,255,0.03)}
    .team-name{font-weight:800;font-size:1.2rem}
    .events-list{width:100%;margin-top:12px;background:transparent}
    .vs-block{width:120px;text-align:center}
    .vs-block .vs{font-size:1.4rem;font-weight:800;color:var(--muted)}
    .back-link{display:inline-block;margin-bottom:12px}
    @media(max-width:820px){ .event-card{flex-direction:column} .vs-block{width:100%} }
    .score-editor{display:flex;gap:12px;align-items:center;justify-content:center;margin-top:12px}
    .score-input{width:64px;padding:.5rem;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text);font-weight:800;font-size:1.1rem;text-align:center}
    .save-btn{padding:.5rem .8rem;border-radius:8px;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#001214;border:0;font-weight:800}
    .match-score-display{font-size:1.2rem;font-weight:900;color:var(--accent);margin-top:8px;text-align:center}
  </style>
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <h1 class="logo">Copa <span class="highlight">Raúl Rojas</span></h1>
      <nav class="nav">
        <a href="index.html#home">Inicio</a>
        <a href="calendar.html">Calendario</a>
      </nav>
    </div>
  </header>

  <main>
    <div class="event-page">
      <a class="back-link" href="calendar.html">← Volver al calendario</a>

      <section class="event-card card">
        <div class="team-side" id="leftTeam">
          <img id="leftPhoto" class="team-photo" src="https://via.placeholder.com/160" alt="Equipo A">
          <div class="team-name" id="leftName">Equipo A</div>
          <div class="events-list" id="leftEvents"><p class="muted">Aquí aparecerán los eventos del equipo (goles, tarjetas, notas).</p></div>
          <div style="margin-top:8px;display:flex;gap:.6rem;align-items:center;justify-content:center">
            <input id="leftEventInput" placeholder="Ej: Gol - Juan (12')" style="flex:1;padding:.45rem;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text)">
            <button id="leftAddEvent" class="save-btn">Añadir</button>
          </div>
        </div>

        <div class="vs-block">
          <div class="vs">VS</div>
          <div class="muted" id="matchTime"></div>
          <div id="scoreDisplay" class="match-score-display"></div>
          <div class="score-editor" id="scoreEditor" style="display:none">
            <input id="scoreLeft" class="score-input" type="number" min="0" value="0">
            <div style="color:var(--muted);font-weight:700">—</div>
            <input id="scoreRight" class="score-input" type="number" min="0" value="0">
            <button id="saveScore" class="save-btn">Guardar resultado</button>
          </div>
        </div>

        <div class="team-side" id="rightTeam">
          <img id="rightPhoto" class="team-photo" src="https://via.placeholder.com/160" alt="Equipo B">
          <div class="team-name" id="rightName">Equipo B</div>
          <div class="events-list" id="rightEvents"><p class="muted">Aquí aparecerán los eventos del equipo (goles, tarjetas, notas).</p></div>
          <div style="margin-top:8px;display:flex;gap:.6rem;align-items:center;justify-content:center">
            <input id="rightEventInput" placeholder="Ej: Gol - Pedro (23')" style="flex:1;padding:.45rem;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text)">
            <button id="rightAddEvent" class="save-btn">Añadir</button>
          </div>
        </div>
      </section>
    </div>
  </main>

  <footer class="site-footer">
    <div class="container"><p>© Copa Raúl Roja — Todos los derechos reservados</p></div>
  </footer>

  <script>
    // Leer parámetros de query ?team1=Name&team2=Name
    const params = new URLSearchParams(location.search);
    const t1 = params.get('team1') || 'Equipo A';
    const t2 = params.get('team2') || 'Equipo B';

    const logos = {
      'Gladiadores': 'https://sclrcoiisappnzbaxlzc.supabase.co/storage/v1/object/public/team-logos/teams/32314b3b-6ef8-4e0a-a5f2-0c9b08c75961/logo.jpg',
      'Klan': 'https://sclrcoiisappnzbaxlzc.supabase.co/storage/v1/object/public/team-logos/teams/37af335f-ef37-4d61-8221-801e13d64713/logo.jpg?v=1758392886644',
      'FC 9no': 'https://sclrcoiisappnzbaxlzc.supabase.co/storage/v1/object/public/team-logos/teams/d00bbe10-d6d8-470a-8ef3-2a4ab27c58c3/logo.jpg',
      'Los Descalsos': 'https://sclrcoiisappnzbaxlzc.supabase.co/storage/v1/object/public/team-logos/teams/0b203679-a1c9-49b1-a316-e2a588495d6f/logo.jpg?v=1758390280487',
      'Scorpions': 'https://sclrcoiisappnzbaxlzc.supabase.co/storage/v1/object/public/team-logos/teams/a9e7ac21-550a-4350-82ae-677979f69a81/logo.jpg?v=1758735227385'
    };

    document.getElementById('leftName').textContent = t1;
    document.getElementById('rightName').textContent = t2;
    document.getElementById('leftPhoto').src = logos[t1] || 'https://via.placeholder.com/160';
    document.getElementById('rightPhoto').src = logos[t2] || 'https://via.placeholder.com/160';

    // Si hay parámetro time, mostrarlo
    const time = params.get('time');
    if(time) document.getElementById('matchTime').textContent = time;

    // Helpers for storing results in localStorage
    function matchKey(a,b,t){
      return `match::${encodeURIComponent(a)}::${encodeURIComponent(b)}::${encodeURIComponent(t||'')}`;
    }

    // Elements
    const scoreDisplay = document.getElementById('scoreDisplay');
    const scoreEditor = document.getElementById('scoreEditor');
    const scoreLeft = document.getElementById('scoreLeft');
    const scoreRight = document.getElementById('scoreRight');
    const saveBtn = document.getElementById('saveScore');
    const leftEventInput = document.getElementById('leftEventInput');
    const rightEventInput = document.getElementById('rightEventInput');
    const leftAddEvent = document.getElementById('leftAddEvent');
    const rightAddEvent = document.getElementById('rightAddEvent');

    // Load saved result (if any)
    function loadResult(){
      const key = matchKey(t1,t2,time);
      const raw = localStorage.getItem(key);
      if(!raw) {
        scoreDisplay.textContent = '';
        scoreEditor.style.display = 'flex';
        return;
      }
      try{
        const obj = JSON.parse(raw);
        scoreDisplay.textContent = `${obj.score1} — ${obj.score2}`;
        scoreLeft.value = obj.score1;
        scoreRight.value = obj.score2;
        scoreEditor.style.display = 'flex';
        renderEvents(obj);
      }catch(e){
        console.error('invalid match data', e);
        scoreEditor.style.display = 'flex';
      }
    }

    function renderEvents(obj){
      const leftEventsEl = document.getElementById('leftEvents');
      const rightEventsEl = document.getElementById('rightEvents');
      leftEventsEl.innerHTML = '';
      rightEventsEl.innerHTML = '';
      // left
      if(obj.eventsLeft && obj.eventsLeft.length){
        obj.eventsLeft.forEach((ev, idx)=>{
          const row = document.createElement('div');
          row.style.display = 'flex'; row.style.justifyContent = 'space-between'; row.style.alignItems = 'center'; row.style.gap = '.6rem';
          const txt = document.createElement('div'); txt.textContent = ev; row.appendChild(txt);
          const del = document.createElement('button'); del.textContent = 'Eliminar'; del.style.background='transparent'; del.style.border='0'; del.style.color='var(--muted)'; del.style.cursor='pointer';
          del.addEventListener('click', ()=>{ removeEvent('left', idx); });
          row.appendChild(del);
          leftEventsEl.appendChild(row);
        })
      } else leftEventsEl.innerHTML = '<p class="muted">Aquí aparecerán los eventos del equipo (goles, tarjetas, notas).</p>';

      // right
      if(obj.eventsRight && obj.eventsRight.length){
        obj.eventsRight.forEach((ev, idx)=>{
          const row = document.createElement('div');
          row.style.display = 'flex'; row.style.justifyContent = 'space-between'; row.style.alignItems = 'center'; row.style.gap = '.6rem';
          const txt = document.createElement('div'); txt.textContent = ev; row.appendChild(txt);
          const del = document.createElement('button'); del.textContent = 'Eliminar'; del.style.background='transparent'; del.style.border='0'; del.style.color='var(--muted)'; del.style.cursor='pointer';
          del.addEventListener('click', ()=>{ removeEvent('right', idx); });
          row.appendChild(del);
          rightEventsEl.appendChild(row);
        })
      } else rightEventsEl.innerHTML = '<p class="muted">Aquí aparecerán los eventos del equipo (goles, tarjetas, notas).</p>';
    }

    function savePayload(obj){
      const key = matchKey(t1,t2,time);
      localStorage.setItem(key, JSON.stringify(obj));
      try{ window.dispatchEvent(new Event('matches-updated')); }catch(e){}
    }

    function addEvent(side, text){
      if(!text || !text.trim()) return;
      const key = matchKey(t1,t2,time);
      let raw = localStorage.getItem(key);
      let payload = raw ? JSON.parse(raw) : {team1:t1,team2:t2,time:time||'',score1:parseInt(scoreLeft.value||0,10),score2:parseInt(scoreRight.value||0,10),eventsLeft:[],eventsRight:[]};
      const entry = text.trim();
      if(side === 'left') payload.eventsLeft = payload.eventsLeft || [], payload.eventsLeft.push(entry);
      else payload.eventsRight = payload.eventsRight || [], payload.eventsRight.push(entry);
      savePayload(payload);
      renderEvents(payload);
    }

    function removeEvent(side, idx){
      const key = matchKey(t1,t2,time);
      let raw = localStorage.getItem(key); if(!raw) return;
      let payload = JSON.parse(raw);
      if(side === 'left'){
        if(!payload.eventsLeft) return; payload.eventsLeft.splice(idx,1);
      } else { if(!payload.eventsRight) return; payload.eventsRight.splice(idx,1); }
      savePayload(payload);
      renderEvents(payload);
    }

    leftAddEvent.addEventListener('click', ()=>{ addEvent('left', leftEventInput.value); leftEventInput.value=''; });
    rightAddEvent.addEventListener('click', ()=>{ addEvent('right', rightEventInput.value); rightEventInput.value=''; });

    saveBtn.addEventListener('click', ()=>{
      const s1 = parseInt(scoreLeft.value||0,10);
      const s2 = parseInt(scoreRight.value||0,10);
      const key = matchKey(t1,t2,time);
      const payload = {team1:t1,team2:t2,time:time||'',score1:s1,score2:s2,eventsLeft:[],eventsRight:[]};
      localStorage.setItem(key, JSON.stringify(payload));
      scoreDisplay.textContent = `${s1} — ${s2}`;
      // notify user briefly
      saveBtn.textContent = 'Guardado ✓';
      setTimeout(()=>saveBtn.textContent = 'Guardar resultado',1400);
      // notify other pages in same tab
      try{ window.dispatchEvent(new Event('matches-updated')); }catch(e){}
    });

    // Initialize
    loadResult();
  </script>
</body>
</html>
